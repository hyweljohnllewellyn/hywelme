<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title >A Website Upgrade from Drupal 6 to Drupal 8 - Part 4 </title>

  <meta name="description" content="Preparing an upgrade to Drupal 8">

  <link rel="shortcut icon" type="image/jpg" href="/favicon.jpg">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://www.hywel.me/drupal/2016/02/11/a-website-upgrade-from-drupal-6-to-drupal-8-part-4.html">
  <link rel="alternate" type="application/rss+xml" title="Have You Wandered Every Land" href="https://www.hywel.me/feed.xml" />  
  <link rel="author" href="https://plus.google.com/u/0/116119715872022757453"/>
</head>


  <body>
    <!-- Google  Ads 
     
 -->
 
    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/" ><img src="https://www.hywel.me/assets/hywel_small.png" alt="Have You Wandered Every Land"></a>


    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
 

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <!--analytics.google.com tracking code-->



    <div class="page-content">
       <!-- REMOVE rapidmailer affiliate 
        <style>
img {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 90%;
}
</style>
 <p>
<a href="https://4c1781zgmdub7l03qnfhj9t1uh.hop.clickbank.net/">
<img alt="email marketing list autoresponder" src="/assets/email marketing list autoresponder.jpg">
</a>
</p>-->

      <div class="wrapper">
        <!-- googlesearch 
        <div>
 <script>
 (function() {
   var cx = '018226365032954961489:hfjstmpp1nk';
   var gcse = document.createElement('script');
   gcse.type = 'text/javascript';
   gcse.async = true;
   gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(gcse, s);
 })();
 </script>
 <gcse:search></gcse:search>
</div>

        -->
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">A Website Upgrade from Drupal 6 to Drupal 8 - Part 4</h1>
    <p class="post-meta">Feb 11, 2016 ✎ hywel •  Drupal 8 migration upgrade full HTML filter null  text format</p>
  </header>

  
  <div style="width: 700px; height: 90px; background: grey;">Google Adsense</div>
  


  <article class="post-content">
    <h2 id="preparing-an-upgrade-to-drupal-8"><a href="https://www.drupal.org/node/2350603">Preparing an upgrade to Drupal 8</a></h2>

<p>According to drupal.org at <a href="https://www.drupal.org/node/2350651">Upgrade using Drush</a> , the requirements are:</p>

<blockquote>
  <p>A fresh installation of Drupal 8 with the core module Migrate Drupal enabled.</p>
</blockquote>

<blockquote>
  <p>The Migrate Upgrade module installed and enabled on the Drupal 8 site.</p>
</blockquote>

<blockquote>
  <p>If you plan on running the upgrade from Drush, you’ll need Drush 8.</p>
</blockquote>

<p>These are covered in <a href="http://www.hywel.me/drupal/2016/02/06/a-website-upgrade-from-drupal-6-to-drupal-8-part-1.html">Part 1</a> and <a href="http://www.hywel.me/drupal/2016/02/07/a-website-upgrade-from-drupal-6-to-drupal-8-part-2.html">Part 2</a>. Screenshot showing enabled modules in Drupal 8:</p>

<p><img src="/assets/2016-02-11/drupal 8 migrate modules enabled.jpg" alt="drupal 8 migrate modules enabled" /></p>

<blockquote>
  <p>Access to the Drupal 6 or 7 database from the host where your new Drupal 8 site is.</p>
</blockquote>

<blockquote>
  <p>Access to the source site’s files.</p>
</blockquote>

<p>The Drupal upgrade will be carried out locally on a Mac.  The Drupal 6 database and files are locally installed.</p>

<blockquote>
  <p>Enable required modules.  The migration process does not install modules on the Drupal 8 destination site and only migrations relevant for modules installed on both the source and destination site are run. Therefore prior to running the migration, you need to enable all modules on the Drupal 8 site for which you want configuration and content upgraded from the source site</p>
</blockquote>

<p>The above statement is a bit confusing, and suggests that it is necessary to identify all Modules used in Drupal 6, their equivalent in Drupal 8 and install them in Drupal 8 prior to upgrade.  In <a href="http://www.hywel.me/drupal/2016/02/10/a-website-upgrade-from-drupal-6-to-drupal-8-part-3.html">Part 3</a>, I carried our a cursory analysis of the modules and installed an XML sitemap module.</p>

<h2 id="executing-an-upgrade-using-drush"><a href="https://www.drupal.org/node/2350651">Executing an upgrade using Drush</a></h2>

<blockquote>
  <p>For more control, you will probably want to pass the –configure-only option to migrate-upgrade, so it will only perform the first step of creating the migrations.</p>
</blockquote>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /Users/hywel/Sites/drupal8
drush migrate-upgrade <span class="nt">--legacy-db-url</span><span class="o">=</span>mysql://hartleyvoicescms:MTwGCDT5Ah74smSW@localhost/hartleyvoicescms <span class="nt">--legacy-root</span><span class="o">=</span>/Users/hywel/Sites/hartleyvoicescms <span class="nt">--configure-only</span></code></pre></figure>

<p>Nothing much happened, it just returned to the prompt.  To some extent, this was expected as the configure-only option was used.  From <a href="https://www.drupal.org/node/2350651">Upgrade using Drush</a>:</p>

<blockquote>
  <p>“After running migrate-drupal with the –configure-only parameter, you run migrate-status to see the list of possible migrations”</p>
</blockquote>

<p>So next was to run:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">drush migrate-status</code></pre></figure>

<p>This was a bit more interesting and summarised what migration was available from Drupal 6.</p>

<p><img src="/assets/2016-02-11/drush 8 migrate status from drupal 6.png" alt="drush 8 migrate status from drupal 6" /></p>

<p>Import the whole list of possible migrations:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /Users/hywel/Sites/drupal8
drush migrate-import <span class="nt">--all</span></code></pre></figure>

<p><img src="/assets/2016-02-11/drush migrate-import all.png" alt="drush migrate-import all" /></p>

<h2 id="drupal-8-first-upgrade-attempt--text-format-issues">Drupal 8 First Upgrade Attempt:  Text Format Issues</h2>

<p>The <em>Missing filter plugin: filternull</em> was shown several times during the import process.</p>

<p>Here is the homepage following the first part of the migrate and update to Drupal 8:</p>

<p><img src="/assets/2016-02-11/first migrate result homepage.png" alt="first migrate result homepage" /></p>

<p>As you can see, some of the menu structure exists, but the layout and body text was not showing at all.</p>

<p><strong>Issue On investigation seems that a second Full_HTML Text format was created during the import that had a broken text filter.</strong></p>

<p>As shown, there are two versions of the Full HTML text format:
<img src="/assets/2016-02-11/full HTML imported from drupal 6.png" alt="full HTML imported from drupal 6" /></p>

<p>The Full HTML text format imported from Drupal 6 was showing a filter null error:
<img src="/assets/2016-02-11/filter null error from drupal 6 text format.png" alt="filter null error from Drupal 6 text format" /></p>

<p>So the Drupal 6 filter was disabled:
<img src="/assets/2016-02-11/disable the full html drupal 6 filter confirm.png" alt="disable the full html Drupal 6 filter confirm" /></p>

<p>After selecting the Drupal 8 Full HTML filter:
<img src="/assets/2016-02-11/select drupal 8 full html text filter.png" alt="select drupal 8 full html text filter" /></p>

<p>The text was showing formatted correctly:
<img src="/assets/2016-02-11/drupal 8 full html text filter working.png" alt="drupal 8 full html text filter working" /></p>

<p>As shown the Drupal 6 filter in node body table was called full_html 1:
<img src="/assets/2016-02-11/full_html1 in the node body table.png" alt="full_html1 in the node body table" /></p>

<h3 id="remove-the-drupal-6-text-format-and-update-the-drupal-8-text-format-to-full-html">Remove the Drupal 6 Text Format and Update the Drupal 8 Text format to Full HTML</h3>

<p>Running the following SQL to update remove the full_html 1 filter imported from Drupal 6 and replace with full_html in Drupal 8.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">update <span class="sb">`</span>node__body<span class="sb">`</span> <span class="nb">set </span>body_format <span class="o">=</span><span class="s1">'full_html'</span><span class="p">;</span>
update <span class="sb">`</span>node__field_sidebar<span class="sb">`</span> <span class="nb">set </span>field_sidebar_format <span class="o">=</span><span class="s1">'full_html'</span><span class="p">;</span>
update <span class="sb">`</span>node__field_sidebar2<span class="sb">`</span> <span class="nb">set </span>field_sidebar2_format <span class="o">=</span><span class="s1">'full_html'</span><span class="p">;</span>
update  <span class="sb">`</span>node_revision__body<span class="sb">`</span> <span class="nb">set </span>body_format <span class="o">=</span><span class="s1">'full_html'</span><span class="p">;</span>
update <span class="sb">`</span>node_revision__field_sidebar<span class="sb">`</span> <span class="nb">set </span>field_sidebar_format <span class="o">=</span><span class="s1">'full_html'</span><span class="p">;</span>
update <span class="sb">`</span>node_revision__field_sidebar2<span class="sb">`</span> <span class="nb">set </span>field_sidebar2_format <span class="o">=</span><span class="s1">'full_html'</span><span class="p">;</span></code></pre></figure>

<p>Followed by rebuilding the Drupal 8 cache :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /Users/hywel/Sites/drupal8
drush cache-rebuild</code></pre></figure>

<h2 id="drupal-8-url-alias-issues">Drupal 8 URL Alias Issues</h2>

<p>As shown in previous screenshots, the URL was showing the node ID, rather that the human readable URL alias.</p>

<p>On investigation it seemed that the language code was not defined on the url_alias table:</p>

<p><img src="/assets/2016-02-11/url_alias drupal 8 lang code not defined following upgrade.png" alt="url_alias drupal 8 lang code not defined following upgrade" /></p>

<p>Back to trusty SQL update and cache rebuild:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">update  <span class="sb">`</span>url_alias<span class="sb">`</span> <span class="nb">set </span>langcode <span class="o">=</span> <span class="s1">'und'</span><span class="p">;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /Users/hywel/Sites/drupal8
drush cache-rebuild</code></pre></figure>

<p>Much better - it almost looks like a website:</p>

<p><img src="/assets/2016-02-11/drupal 8 first migation after url_alias fix.jpg" alt="drupal 8 first migation after url_alias fix" /></p>

<h2 id="drupal-6-versus-drupal-8---where-are-the-images-and-audio">Drupal 6 versus Drupal 8 - Where are the images and audio?</h2>

<p><strong>Drupal 6 - Live Site:</strong></p>

<p><img src="/assets/2016-02-11/three tenors drupal 6.jpg" alt="three tenors drupal 6.jpg" /></p>

<p><strong>Drupal 8 - First Upgrade:</strong></p>

<p><img src="/assets/2016-02-11/three tenors drupal 8.jpg" alt="three tenors drupal 8.jpg" /></p>

<p>So next will be identifying where the asset files are and starting to look at formatting the site.</p>

<h3 id="drupal-8---asset-files-error">Drupal 8 - Asset Files Error</h3>

<p>So I noticed that there was an error in the original Drush migate upgrade command - the path to local legacy root folder was incorrect.  After some time investigating, I could not find any way to change this - so decided to start all over again - A Second attempt, repeating the steps from <a href="http://www.hywel.me/drupal/2016/02/06/a-website-upgrade-from-drupal-6-to-drupal-8-part-1.html">Part 1</a> onward, but  with the corrected local folder:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /Users/hywel/Sites/drupal8
drush migrate-upgrade <span class="nt">--legacy-db-url</span><span class="o">=</span>mysql://hartleyvoicescms:MTwGCDT5Ah74smSW@localhost/hartleyvoicescms <span class="nt">--legacy-root</span><span class="o">=</span>/Users/hywel/Sites/hartleyvoicescouk/public </code></pre></figure>

<p><strong>Drupal 8 - Second Upgrade - with images:</strong>
<img src="/assets/2016-02-11/three tenors after second upgrade attempt.jpg" alt="three tenors after second upgrade attempt" /></p>

  </article>
  
  <!--script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></!--script><script type="text/javascript">window.dojoRequire(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us4.list-manage.com","uuid":"48b03903f0056c08b4b13ac15","lid":"c907802f48","uniqueMethods":true}) })</script-->
  
  <b> Copyright © 2017 Hywel John Llewellyn </b>
<!-- Hywel Start Disqus Comments -->
  <div id="disqus_thread"></div>
  <script>
      /**
       *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
       *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
       */
      var disqus_config = function () {
          this.page.url =  "https://www.hywel.me/drupal/2016/02/11/a-website-upgrade-from-drupal-6-to-drupal-8-part-4.html";  // Replace PAGE_URL with your page's canonical URL variable

          //this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };

      (function() {  // DON'T EDIT BELOW THIS LINE
          var d = document, s = d.createElement('script');

          s.src = '//hywelme.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<!-- Hywel End Disqus Comments -->

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Have You Wandered Every Land</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">

    
          <li><a href="https://www.hywel.me/privacy-policy">Privacy Policy</a></li>
          <!--li><a href="mailto:contact@hywel.me">contact@hywel.me</a> </li> -->
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/hyweljohnllewellyn">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">hyweljohnllewellyn</span>
            </a>
          </li>
          

          
        </ul>
      </div>

      <!--div class="footer-col  footer-col-3">
        <p class="text">A personal blog site, with musings about technology and documenting what I learn.
</p>
     </div-->
      <!--  google advert hywelme start -->
    <div class="footer-col  footer-col-3">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1549458855743321"
         data-ad-slot="1092663097"
         data-ad-format="auto"></ins>
    <script>
     (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
   <!--google advert hywelme end -->
  </div>

  </div>

</footer>


  </body>

</html>
